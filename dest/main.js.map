{
  "version": 3,
  "sources": ["../ops/open.ts", "../core/asyncRequest.ts", "../ops/add.ts", "../ops/addBulk.ts", "../ops/put.ts", "../ops/putBulk.ts", "../ops/del.ts", "../ops/delBulk.ts", "../ops/get.ts", "../ops/getAll.ts", "../ops/getAllKeys.ts", "../ops/getKey.ts", "../ops/clear.ts", "../ops/count.ts", "../ops/batch.ts"],
  "sourcesContent": ["export function open(name: string, version: number) {\n  const request = indexedDB.open(name, version);\n\n  return {\n    upgrade: (callback: (event: IDBVersionChangeEvent) => void) => {\n      request.onupgradeneeded = callback;\n    },\n    blocked: (callback: (event: Event) => void) => {\n      request.onblocked = callback;\n    },\n    ready: new Promise<IDBDatabase>((resolve, reject) => {\n      request.onsuccess = () => resolve(request.result);\n      request.onerror = () => reject(request.error);\n    }),\n  };\n}\n", "export function asyncRequest<T>(\n  req: IDBRequest<T>,\n) {\n  return new Promise<T>((resolve, reject) => {\n    req.addEventListener(\"success\", (ev) => {\n      const target = ev.target as IDBRequest;\n      resolve(target.result);\n    });\n    req.addEventListener(\n      \"error\",\n      (ev) => {\n        const target = ev.target as IDBRequest;\n        reject(new Error(`IndexedDB error: ${target.error?.message}`));\n      },\n    );\n  });\n}\n", "import { asyncRequest } from \"../core/asyncRequest.ts\";\n\nexport function add<T>(store: IDBObjectStore, item: T, key?: IDBValidKey) {\n  return asyncRequest(store.add(item, key));\n}\n", "import { add } from \"./add.ts\";\n\nexport function addBulk<T>(\n  store: IDBObjectStore,\n  items: T[] = [],\n  key?: IDBValidKey,\n) {\n  return Promise.all(items.map((item) => add(store, item, key)));\n}\n", "import { asyncRequest } from \"../core/asyncRequest.ts\";\n\nexport function put<T>(store: IDBObjectStore, item: T, key?: IDBValidKey) {\n  return asyncRequest(store.put(item, key));\n}\n", "import { put } from \"./put.ts\";\n\nexport function putBulk<T>(\n  store: IDBObjectStore,\n  items: T[] = [],\n  key?: IDBValidKey,\n) {\n  return Promise.all(items.map((item) => put(store, item, key)));\n}\n", "import { asyncRequest } from \"../core/asyncRequest.ts\";\n\nexport function del(\n  store: IDBObjectStore,\n  query: IDBValidKey | IDBKeyRange,\n) {\n  return asyncRequest(store.delete(query));\n}\n", "import { del } from \"./del.ts\";\n\nexport function delBulk(\n  store: IDBObjectStore,\n  keys: Array<IDBValidKey | IDBKeyRange>,\n) {\n  return Promise.all(keys.map((key) => del(store, key)));\n}\n", "import { asyncRequest } from \"../core/asyncRequest.ts\";\n\nexport function get<T>(store: IDBObjectStore, query: IDBValidKey) {\n  // indexeddb get operation\n  return asyncRequest<T | undefined>(store.get(query));\n}\n", "import { asyncRequest } from \"../core/asyncRequest.ts\";\n\nexport function getAll<T>(\n  store: IDBObjectStore,\n  query?: IDBValidKey | IDBKeyRange,\n) {\n  // indexeddb get operation\n  return asyncRequest<T[]>(store.getAll(query));\n}\n", "import { asyncRequest } from \"../core/asyncRequest.ts\";\n\nexport function getAllKeys(\n  store: IDBObjectStore,\n  query?: IDBValidKey | IDBKeyRange,\n) {\n  // indexeddb get operation\n  return asyncRequest<IDBValidKey[]>(store.getAllKeys(query));\n}\n", "import { asyncRequest } from \"../core/asyncRequest.ts\";\n\nexport function getKey(store: IDBObjectStore, query: IDBValidKey) {\n  // indexeddb get operation\n  return asyncRequest<IDBValidKey | undefined>(store.getKey(query));\n}\n", "import { asyncRequest } from \"../core/asyncRequest.ts\";\n\nexport function clear(store: IDBObjectStore) {\n  return asyncRequest(store.clear());\n}\n", "import { asyncRequest } from \"../core/asyncRequest.ts\";\n\nexport function count(store: IDBObjectStore, query?: IDBValidKey) {\n  return asyncRequest(store.count(query));\n}\n", "// deno-lint-ignore-file no-explicit-any\n\ninterface IDBXAddCommand<T> {\n  storeName: string;\n  method: \"add\";\n  data: T | T[];\n  key?: IDBValidKey;\n}\n\ninterface IDBXPutCommand<T> {\n  storeName: string;\n  method: \"put\";\n  data: T | T[];\n  key?: IDBValidKey;\n}\n\ninterface IDBXDeleteCommand {\n  storeName: string;\n  method: \"delete\" | \"del\";\n  key: IDBValidKey | IDBKeyRange;\n}\n\ninterface IDBXClearCommand {\n  storeName: string;\n  method: \"clear\";\n}\n\ninterface IDBXGetCommand {\n  storeName: string;\n  method: \"get\";\n  query: IDBValidKey;\n}\n\ninterface IDBXGetAllCommand {\n  storeName: string;\n  method: \"getAll\";\n  query: IDBValidKey | IDBKeyRange;\n  count?: number;\n}\n\ninterface IDBXGetAllKeysCommand {\n  storeName: string;\n  method: \"getAllKeys\";\n  query: IDBValidKey | IDBKeyRange;\n  count?: number;\n}\n\ninterface IDBXGetKeyCommand {\n  storeName: string;\n  method: \"getKey\";\n  query: IDBValidKey;\n}\n\ninterface IDBXCountCommand {\n  storeName: string;\n  method: \"count\";\n  query: IDBValidKey | IDBKeyRange;\n}\n\ntype IDBXCommand<T> =\n  | IDBXAddCommand<T>\n  | IDBXPutCommand<T>\n  | IDBXDeleteCommand\n  | IDBXClearCommand\n  | IDBXGetCommand\n  | IDBXGetAllCommand\n  | IDBXGetAllKeysCommand\n  | IDBXGetKeyCommand\n  | IDBXCountCommand;\n\nfunction write<T>(\n  store: IDBObjectStore,\n  command: IDBXAddCommand<T> | IDBXPutCommand<T>,\n) {\n  const { method, data, key } = command;\n  if (Array.isArray(data)) {\n    for (const item of data) {\n      store[method](item, key);\n    }\n  } else {\n    store[method](data, key);\n  }\n}\n\nexport function batch<T>(\n  db: IDBDatabase,\n  commands: IDBXCommand<T>[],\n  mode: IDBTransactionMode,\n) {\n  const set = new Set(commands.map((c) => c.storeName));\n  const storeNames = Array.from(set);\n\n  const tx = db.transaction(storeNames, mode);\n  const results: any[] = [];\n  for (const command of commands) {\n    const store = tx.objectStore(command.storeName);\n    switch (command.method) {\n      case \"add\": {\n        write(store, command as IDBXAddCommand<T>);\n        break;\n      }\n      case \"put\": {\n        write(store, command as IDBXPutCommand<T>);\n        break;\n      }\n      case \"delete\":\n      case \"del\": {\n        const { key } = command;\n        if (Array.isArray(key)) {\n          for (const k of key) {\n            results.push([\"del\", store.delete(k)]);\n          }\n        } else {\n          results.push([\"del\", store.delete(key)]);\n        }\n        break;\n      }\n      case \"clear\": {\n        results.push([\"clear\", store.clear()]);\n        break;\n      }\n      case \"get\": {\n        const { query } = command;\n        results.push([\"get\", store.get(query)]);\n        break;\n      }\n      case \"getAll\": {\n        const { query, count } = command;\n        results.push([\"getAll\", store.getAll(query, count)]);\n        break;\n      }\n      case \"getAllKeys\": {\n        const { query, count } = command;\n        results.push([\"getAllKeys\", store.getAllKeys(query, count)]);\n        break;\n      }\n      case \"getKey\": {\n        const { query } = command;\n        results.push([\"getKey\", store.getKey(query)]);\n        break;\n      }\n      case \"count\": {\n        const { query } = command;\n        results.push([\"count\", store.count(query)]);\n        break;\n      }\n    }\n  }\n  tx.commit();\n  return {\n    abort: () => tx.abort(),\n    completed: new Promise((resolve, reject) => {\n      tx.oncomplete = () => resolve(results);\n      tx.onerror = () => reject(tx.error);\n    }),\n  };\n}\n"],
  "mappings": "AAAO,SAASA,EAAKC,EAAcC,EAAiB,CAClD,IAAMC,EAAU,UAAU,KAAKF,EAAMC,CAAO,EAE5C,MAAO,CACL,QAAUE,GAAqD,CAC7DD,EAAQ,gBAAkBC,CAC5B,EACA,QAAUA,GAAqC,CAC7CD,EAAQ,UAAYC,CACtB,EACA,MAAO,IAAI,QAAqB,CAACC,EAASC,IAAW,CACnDH,EAAQ,UAAY,IAAME,EAAQF,EAAQ,MAAM,EAChDA,EAAQ,QAAU,IAAMG,EAAOH,EAAQ,KAAK,CAC9C,CAAC,CACH,CACF,CCfO,SAASI,EACdC,EACA,CACA,OAAO,IAAI,QAAW,CAACC,EAASC,IAAW,CACzCF,EAAI,iBAAiB,UAAYG,GAAO,CACtC,IAAMC,EAASD,EAAG,OAClBF,EAAQG,EAAO,MAAM,CACvB,CAAC,EACDJ,EAAI,iBACF,QACCG,GAAO,CACN,IAAMC,EAASD,EAAG,OAClBD,EAAO,IAAI,MAAM,oBAAoBE,EAAO,OAAO,OAAO,EAAE,CAAC,CAC/D,CACF,CACF,CAAC,CACH,CCdO,SAASC,EAAOC,EAAuBC,EAASC,EAAmB,CACxE,OAAOC,EAAaH,EAAM,IAAIC,EAAMC,CAAG,CAAC,CAC1C,CCFO,SAASE,EACdC,EACAC,EAAa,CAAC,EACdC,EACA,CACA,OAAO,QAAQ,IAAID,EAAM,IAAKE,GAASC,EAAIJ,EAAOG,EAAMD,CAAG,CAAC,CAAC,CAC/D,CCNO,SAASG,EAAOC,EAAuBC,EAASC,EAAmB,CACxE,OAAOC,EAAaH,EAAM,IAAIC,EAAMC,CAAG,CAAC,CAC1C,CCFO,SAASE,EACdC,EACAC,EAAa,CAAC,EACdC,EACA,CACA,OAAO,QAAQ,IAAID,EAAM,IAAKE,GAASC,EAAIJ,EAAOG,EAAMD,CAAG,CAAC,CAAC,CAC/D,CCNO,SAASG,EACdC,EACAC,EACA,CACA,OAAOC,EAAaF,EAAM,OAAOC,CAAK,CAAC,CACzC,CCLO,SAASE,EACdC,EACAC,EACA,CACA,OAAO,QAAQ,IAAIA,EAAK,IAAKC,GAAQC,EAAIH,EAAOE,CAAG,CAAC,CAAC,CACvD,CCLO,SAASE,EAAOC,EAAuBC,EAAoB,CAEhE,OAAOC,EAA4BF,EAAM,IAAIC,CAAK,CAAC,CACrD,CCHO,SAASE,EACdC,EACAC,EACA,CAEA,OAAOC,EAAkBF,EAAM,OAAOC,CAAK,CAAC,CAC9C,CCNO,SAASE,EACdC,EACAC,EACA,CAEA,OAAOC,EAA4BF,EAAM,WAAWC,CAAK,CAAC,CAC5D,CCNO,SAASE,EAAOC,EAAuBC,EAAoB,CAEhE,OAAOC,EAAsCF,EAAM,OAAOC,CAAK,CAAC,CAClE,CCHO,SAASE,EAAMC,EAAuB,CAC3C,OAAOC,EAAaD,EAAM,MAAM,CAAC,CACnC,CCFO,SAASE,EAAMC,EAAuBC,EAAqB,CAChE,OAAOC,EAAaF,EAAM,MAAMC,CAAK,CAAC,CACxC,CCkEA,SAASE,EACPC,EACAC,EACA,CACA,GAAM,CAAE,OAAAC,EAAQ,KAAAC,EAAM,IAAAC,CAAI,EAAIH,EAC9B,GAAI,MAAM,QAAQE,CAAI,EACpB,QAAWE,KAAQF,EACjBH,EAAME,CAAM,EAAEG,EAAMD,CAAG,OAGzBJ,EAAME,CAAM,EAAEC,EAAMC,CAAG,CAE3B,CAEO,SAASE,EACdC,EACAC,EACAC,EACA,CACA,IAAMC,EAAM,IAAI,IAAIF,EAAS,IAAKG,GAAMA,EAAE,SAAS,CAAC,EAC9CC,EAAa,MAAM,KAAKF,CAAG,EAE3BG,EAAKN,EAAG,YAAYK,EAAYH,CAAI,EACpCK,EAAiB,CAAC,EACxB,QAAWb,KAAWO,EAAU,CAC9B,IAAMR,EAAQa,EAAG,YAAYZ,EAAQ,SAAS,EAC9C,OAAQA,EAAQ,OAAQ,CACtB,IAAK,MAAO,CACVF,EAAMC,EAAOC,CAA4B,EACzC,KACF,CACA,IAAK,MAAO,CACVF,EAAMC,EAAOC,CAA4B,EACzC,KACF,CACA,IAAK,SACL,IAAK,MAAO,CACV,GAAM,CAAE,IAAAG,CAAI,EAAIH,EAChB,GAAI,MAAM,QAAQG,CAAG,EACnB,QAAWW,KAAKX,EACdU,EAAQ,KAAK,CAAC,MAAOd,EAAM,OAAOe,CAAC,CAAC,CAAC,OAGvCD,EAAQ,KAAK,CAAC,MAAOd,EAAM,OAAOI,CAAG,CAAC,CAAC,EAEzC,KACF,CACA,IAAK,QAAS,CACZU,EAAQ,KAAK,CAAC,QAASd,EAAM,MAAM,CAAC,CAAC,EACrC,KACF,CACA,IAAK,MAAO,CACV,GAAM,CAAE,MAAAgB,CAAM,EAAIf,EAClBa,EAAQ,KAAK,CAAC,MAAOd,EAAM,IAAIgB,CAAK,CAAC,CAAC,EACtC,KACF,CACA,IAAK,SAAU,CACb,GAAM,CAAE,MAAAA,EAAO,MAAAC,CAAM,EAAIhB,EACzBa,EAAQ,KAAK,CAAC,SAAUd,EAAM,OAAOgB,EAAOC,CAAK,CAAC,CAAC,EACnD,KACF,CACA,IAAK,aAAc,CACjB,GAAM,CAAE,MAAAD,EAAO,MAAAC,CAAM,EAAIhB,EACzBa,EAAQ,KAAK,CAAC,aAAcd,EAAM,WAAWgB,EAAOC,CAAK,CAAC,CAAC,EAC3D,KACF,CACA,IAAK,SAAU,CACb,GAAM,CAAE,MAAAD,CAAM,EAAIf,EAClBa,EAAQ,KAAK,CAAC,SAAUd,EAAM,OAAOgB,CAAK,CAAC,CAAC,EAC5C,KACF,CACA,IAAK,QAAS,CACZ,GAAM,CAAE,MAAAA,CAAM,EAAIf,EAClBa,EAAQ,KAAK,CAAC,QAASd,EAAM,MAAMgB,CAAK,CAAC,CAAC,EAC1C,KACF,CACF,CACF,CACA,OAAAH,EAAG,OAAO,EACH,CACL,MAAO,IAAMA,EAAG,MAAM,EACtB,UAAW,IAAI,QAAQ,CAACK,EAASC,IAAW,CAC1CN,EAAG,WAAa,IAAMK,EAAQJ,CAAO,EACrCD,EAAG,QAAU,IAAMM,EAAON,EAAG,KAAK,CACpC,CAAC,CACH,CACF",
  "names": ["open", "name", "version", "request", "callback", "resolve", "reject", "asyncRequest", "req", "resolve", "reject", "ev", "target", "add", "store", "item", "key", "asyncRequest", "addBulk", "store", "items", "key", "item", "add", "put", "store", "item", "key", "asyncRequest", "putBulk", "store", "items", "key", "item", "put", "del", "store", "query", "asyncRequest", "delBulk", "store", "keys", "key", "del", "get", "store", "query", "asyncRequest", "getAll", "store", "query", "asyncRequest", "getAllKeys", "store", "query", "asyncRequest", "getKey", "store", "query", "asyncRequest", "clear", "store", "asyncRequest", "count", "store", "query", "asyncRequest", "write", "store", "command", "method", "data", "key", "item", "batch", "db", "commands", "mode", "set", "c", "storeNames", "tx", "results", "k", "query", "count", "resolve", "reject"]
}
